openapi: 3.0.3
info:
  title: SIMRS Authentication API
  description: |
    REST API untuk autentikasi dan manajemen sesi SIMRS.
    
    ## Authentication
    Protected endpoints membutuhkan header:
    ```
    Authorization: Bearer <access_token>
    ```
  version: 1.0.0
  contact:
    name: SIMRS Team
    
servers:
  - url: http://localhost:8080
    description: Development server

tags:
  - name: Authentication
    description: Login, logout, refresh token
  - name: Session
    description: Session management

paths:
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Login dengan username dan password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              username: admin
              password: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_credentials:
                  value:
                    success: false
                    error:
                      code: INVALID_CREDENTIALS
                      message: Invalid username or password
                user_inactive:
                  value:
                    success: false
                    error:
                      code: USER_INACTIVE
                      message: User account is inactive

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Revoke current session
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Successfully logged out
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get logged in user info and permissions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/sessions:
    get:
      tags:
        - Session
      summary: List active sessions
      description: Get all active login sessions for current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/sessions/{id}/revoke:
    post:
      tags:
        - Session
      summary: Revoke session
      description: Logout specific session
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Session ID to revoke
      responses:
        '200':
          description: Session revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Session revoked successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
          example: admin
        password:
          type: string
          minLength: 1
          example: password123

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            tokens:
              $ref: '#/components/schemas/Tokens'
            session:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                created_at:
                  type: string
                  format: date-time

    RefreshRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          example: eyJhbGciOiJIUzI1NiIs...

    RefreshResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            tokens:
              $ref: '#/components/schemas/Tokens'

    MeResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'

    SessionListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            sessions:
              type: array
              items:
                $ref: '#/components/schemas/Session'
            total:
              type: integer
              example: 2

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440001
        username:
          type: string
          example: admin
        email:
          type: string
          format: email
          example: admin@hospital.com
        is_active:
          type: boolean
          example: true
        last_login_at:
          type: string
          format: date-time
          nullable: true
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        permissions:
          type: array
          items:
            type: string
          example:
            - patient.read
            - patient.create
            - billing.read

    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: admin

    Tokens:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token (15 min expiry)
        refresh_token:
          type: string
          description: JWT refresh token (7 day expiry)
        token_type:
          type: string
          example: Bearer
        expires_at:
          type: string
          format: date-time

    Session:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_info:
          type: string
          example: Mozilla/5.0 (Windows NT 10.0...)
        ip_address:
          type: string
          example: 192.168.1.100
        created_at:
          type: string
          format: date-time
        last_seen_at:
          type: string
          format: date-time
        is_current:
          type: boolean
          description: True if this is the requesting session
        is_active:
          type: boolean
          description: True if not revoked
        revoked_at:
          type: string
          format: date-time
          nullable: true

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              enum:
                - INVALID_CREDENTIALS
                - USER_NOT_FOUND
                - USER_INACTIVE
                - INVALID_TOKEN
                - EXPIRED_TOKEN
                - SESSION_REVOKED
                - PERMISSION_DENIED
                - VALIDATION_ERROR
                - INTERNAL_ERROR
            message:
              type: string
